<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>14&nbsp; Melodies in Folk Songs – INTRODUCTION TO DIGITAL MUSICOLOGY</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04_jazz_solos.html" rel="next">
<link href="./12_dma_melody.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11_dma_harmony.html">WORKING WITH MUSIC DATA</a></li><li class="breadcrumb-item"><a href="./03_melody_I.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Melodies in Folk Songs</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">INTRODUCTION TO DIGITAL MUSICOLOGY</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">INTRODUCTION</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_what_is_dm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">What is Digital Musicology?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_dm_today.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Digital Musicology today</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_history_of_dm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The history of Digital Musicology</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">DATA ABOUT MUSIC</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_RISM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">RISM metadata</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_spotify_musicbrainz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Spotify and MusicBrainz metadata</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_streaming_industry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Music and the streaming industry</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./billboard_charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Analyzing song survival</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">MUSIC AS DATA</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_audio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Audio</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_MIDI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MIDI</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09_MEI_header.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">MEI - header</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10_MEI_body.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">MEI - the body</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">WORKING WITH MUSIC DATA</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_dma_harmony.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Digital music analysis: harmony</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_dma_melody.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Digital music analysis: melody</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_melody_I.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Melodies in Folk Songs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_jazz_solos.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Solos in the <em>Weimar Jazz Database</em></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_data-driven_music_history.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Data-Driven Music History</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">CRITICAL DIGITAL MUSICOLOGY</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13_copyright.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Copyright</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14_representation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Representation and representativeness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15_discussion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Discussion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-essen-folksong-collection" id="toc-the-essen-folksong-collection" class="nav-link active" data-scroll-target="#the-essen-folksong-collection"><span class="header-section-number">14.1</span> The <em>Essen Folksong Collection</em></a></li>
  <li><a href="#comparing-songs" id="toc-comparing-songs" class="nav-link" data-scroll-target="#comparing-songs"><span class="header-section-number">14.2</span> Comparing songs</a></li>
  <li><a href="#computational-analysis" id="toc-computational-analysis" class="nav-link" data-scroll-target="#computational-analysis"><span class="header-section-number">14.3</span> Computational analysis</a></li>
  <li><a href="#the-melodic-arc" id="toc-the-melodic-arc" class="nav-link" data-scroll-target="#the-melodic-arc"><span class="header-section-number">14.4</span> The melodic arc</a></li>
  <li><a href="#intervals" id="toc-intervals" class="nav-link" data-scroll-target="#intervals"><span class="header-section-number">14.5</span> Intervals</a></li>
  <li><a href="#n-grams" id="toc-n-grams" class="nav-link" data-scroll-target="#n-grams"><span class="header-section-number">14.6</span> n-grams</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./11_dma_harmony.html">WORKING WITH MUSIC DATA</a></li><li class="breadcrumb-item"><a href="./03_melody_I.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Melodies in Folk Songs</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Melodies in Folk Songs</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>On Jupyter Hub, change the kernel to Python 3.7!</strong></p>
<div id="cell-2" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> music21 <span class="im">as</span> m21</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sns.set_context(<span class="st">"notebook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Tragen Sie hier bitte Ihren username ein:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># USERNAME = "fmoss"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">## for jupyter hubs</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># %env QT_QPA_PLATFORM=offscreen </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # new user, create music21 environment variables.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># m21.environment.set('musicxmlPath', value='/usr/bin/mscore')</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># m21.environment.set('musescoreDirectPNGPath', value='/usr/bin/mscore')</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># m21.environment.set('graphicsPath', value=f'/home/{USERNAME}') # change accordingly for your own username!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="the-essen-folksong-collection" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="the-essen-folksong-collection"><span class="header-section-number">14.1</span> The <em>Essen Folksong Collection</em></h2>
<p>In this session, we work with a corpus of melodies, the <em>Essen Folksong Collection</em> (EFC). There are several ways to access this corpus, for example through the interface provided by the Center for Computer Assisted Research in the Humanities (CCARH) at Stanford University: http://essen.themefinder.org/ or via http://kern.ccarh.org/browse?l=essen.</p>
<p>A more convenient way to work with the pieces is by using the Python library <code>music21</code>. This library was developed and is maintaned my Mike Cuthbert at the MIT and is the most popular library for the computational analysis of symbolic music (i.e.&nbsp;scores). You can find its documentation here: http://web.mit.edu/music21/</p>
<p>However, using <code>music21</code> requires some training and getting used to its particular API (the way how to interact with its functions). We will not get into too many details here but rather showcase how it can be used for our purposes.</p>
<p>The first thing we do is to load the entire EFC and store it in a variable named <code>corpora</code>.</p>
<div id="cell-6" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load corpus</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>corpora <span class="op">=</span> m21.corpus.getComposer(<span class="st">'essenFolksong'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calling the variable <code>corpora</code> shows that it consists of a list of file paths. Using the <code>len()</code> function, we can find out how many corpora are stored in the variable <code>corpora</code>.</p>
<div id="cell-8" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(corpora)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>31</code></pre>
</div>
</div>
<p>We can also directly call the variable <code>corpora</code> to see what it contains:</p>
<div id="cell-10" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>corpora</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>[WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/altdeu10.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/altdeu20.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/ballad10.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/ballad20.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/ballad30.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/ballad40.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/ballad50.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/ballad60.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/ballad70.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/ballad80.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/boehme10.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/boehme20.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/dva0.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/erk10.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/erk20.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/erk30.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/erk5.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/fink0.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/folkHaydn.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/han1.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/han2.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/irl.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/kinder0.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/lot.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/lux.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/test0.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/test1.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/testd.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/teste.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/variant0.abc'),
 WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/zuccal0.abc')]</code></pre>
</div>
</div>
<p>The variable <code>corpora</code> is a list of file paths, each of which points to a corpus in this collection. Note that the location depends on the location where <code>music21</code> is installed. If you would do this on your own computer, you would see different paths. The file names at the end of the file paths indicate what they contain, e.g.&nbsp;<code>altdeu10.abc</code> contains old German folksongs, <code>boehme10.abc</code> contains Czech folksongs, and <code>han1.abc</code> contains Chinese folksongs.</p>
<p>The <code>.abc</code> file ending refers to the ABC notation for encoding melodies. You find more information about the ABC encoding here: http://abcnotation.com/</p>
<p>For example, a song could be encoded like this:</p>
<div id="cell-12" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>example_song <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="st">X:1</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">T:Speed the Plough</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">M:4/4</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">C:Trad.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">K:G</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">|:GABc dedB|dedB dedB|c2ec B2dB|c2A2 A2BA|</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">  GABc dedB|dedB dedB|c2ec B2dB|A2F2 G4:|</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">|:g2gf gdBd|g2f2 e2d2|c2ec B2dB|c2A2 A2df|</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">  g2gf g2Bd|g2f2 e2d2|c2ec B2dB|A2F2 G4:|</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The tripple quotes (<code>"""</code>) surrounding the ABC notation are used by Python to store multi-line text.</p>
<p>What can we already understand from this encoding?</p>
<p><code>music21</code> can load this string and display a graphical output of the score. This is done by a <strong>parser</strong>. A parser is a program that reads a file and produces a structured output.</p>
<div id="cell-16" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>parsed_example_song <span class="op">=</span> m21.converter.parse(example_song)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We did not need to give it the entire string again because we have already saved it in the <code>example_song</code> variable. The purpose of variables is that you can refer to them later in your code without explicitly needing to state its value.</p>
<p>Calling the variable <code>parsed_example_song</code> now, however, does not really help us here…</p>
<div id="cell-19" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>parsed_example_song</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>&lt;music21.stream.Score 0x1898a474340&gt;</code></pre>
</div>
</div>
<p>It returns a somewhat cryptic statement that says that the variable countains a <code>music21.stream.Score</code> object. Understanding the internal organization of <code>music21</code> goes beyond this class. For us, it is suffient to know that these objects have certain associated functions, called <strong>methods</strong>, that we can use on them. To look at the score of this example song, we use the method <code>.show()</code>.</p>
<div id="cell-21" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>parsed_example_song.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-10-output-1.png" width="753" height="416" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Voilà, this is much better! Now, let us compare the score output to the ABC encoding of the song:</p>
<div id="cell-23" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(example_song)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
X:1
T:Speed the Plough
M:4/4
C:Trad.
K:G
|:GABc dedB|dedB dedB|c2ec B2dB|c2A2 A2BA|
  GABc dedB|dedB dedB|c2ec B2dB|A2F2 G4:|
|:g2gf gdBd|g2f2 e2d2|c2ec B2dB|c2A2 A2df|
  g2gf g2Bd|g2f2 e2d2|c2ec B2dB|A2F2 G4:|
</code></pre>
</div>
</div>
<p>Now the ABC notation makes already more sense. <code>T:Speed the Ploug</code> stands for the title, <code>M:4/4</code> for the meter, and <code>K:G</code> for the key of the song. The <a href="http://abcnotation.com/blog/2010/01/31/how-to-understand-abc-the-basics/">ABC documentation</a> tells us that <code>X:1</code> encodes just a reference number, in case multiple pieces are stored in the same file (as in our case in the variable <code>corpora</code>, remember?). And the lines at the bottom encode the proper melody, where the letters represent note names that are organized into bars with or without repetition signs.</p>
<p><code>music21</code> even gives us the option to listen to the song if we path the <code>midi</code> argument to the <code>.show()</code> method:</p>
<div id="cell-26" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>parsed_example_song.show(<span class="st">"midi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

                <div id="midiPlayerDiv2080"></div>
                <link rel="stylesheet" href="//cuthbertLab.github.io/music21j/css/m21.css" type="text/css">
                <script>
                require.config({
                    paths: {'music21': '//cuthbertLab.github.io/music21j/src/music21'}
                });
                require(['music21'], function() {
                               mp = new music21.miditools.MidiPlayer();
                               mp.addPlayer('#midiPlayerDiv2080');
                               mp.base64Load('data:audio/midi;base64,TVRoZAAAAAYAAQABBABNVHJrAAADYQD/AwAA4ABAAP9ZAgEAAP9YBAQCGAiIAJBDWoQAgEMAAJBFWoQAgEUAAJBHWoQAgEcAAJBIWoQAgEgAAJBKWoQAgEoAAJBMWoQAgEwAAJBKWoQAgEoAAJBHWoQAgEcAAJBKWoQAgEoAAJBMWoQAgEwAAJBKWoQAgEoAAJBHWoQAgEcAAJBKWoQAgEoAAJBMWoQAgEwAAJBKWoQAgEoAAJBHWoQAgEcAAJBIWogAgEgAAJBMWoQAgEwAAJBIWoQAgEgAAJBHWogAgEcAAJBKWoQAgEoAAJBHWoQAgEcAAJBIWogAgEgAAJBFWogAgEUAAJBFWogAgEUAAJBHWoQAgEcAAJBFWoQAgEUAAJBDWoQAgEMAAJBFWoQAgEUAAJBHWoQAgEcAAJBIWoQAgEgAAJBKWoQAgEoAAJBMWoQAgEwAAJBKWoQAgEoAAJBHWoQAgEcAAJBKWoQAgEoAAJBMWoQAgEwAAJBKWoQAgEoAAJBHWoQAgEcAAJBKWoQAgEoAAJBMWoQAgEwAAJBKWoQAgEoAAJBHWoQAgEcAAJBIWogAgEgAAJBMWoQAgEwAAJBIWoQAgEgAAJBHWogAgEcAAJBKWoQAgEoAAJBHWoQAgEcAAJBFWogAgEUAAJBCWogAgEIAAJBDWpAAgEMAAJBPWogAgE8AAJBPWoQAgE8AAJBOWoQAgE4AAJBPWoQAgE8AAJBKWoQAgEoAAJBHWoQAgEcAAJBKWoQAgEoAAJBPWogAgE8AAJBOWogAgE4AAJBMWogAgEwAAJBKWogAgEoAAJBIWogAgEgAAJBMWoQAgEwAAJBIWoQAgEgAAJBHWogAgEcAAJBKWoQAgEoAAJBHWoQAgEcAAJBIWogAgEgAAJBFWogAgEUAAJBFWogAgEUAAJBKWoQAgEoAAJBOWoQAgE4AAJBPWogAgE8AAJBPWoQAgE8AAJBOWoQAgE4AAJBPWogAgE8AAJBHWoQAgEcAAJBKWoQAgEoAAJBPWogAgE8AAJBOWogAgE4AAJBMWogAgEwAAJBKWogAgEoAAJBIWogAgEgAAJBMWoQAgEwAAJBIWoQAgEgAAJBHWogAgEcAAJBKWoQAgEoAAJBHWoQAgEcAAJBFWogAgEUAAJBCWogAgEIAAJBDWpAAgEMAiAD/LwA=');
                        });
                </script>
</div>
</div>
<p>Now, what happens if we try to parse one of the corpora in the EFC? We can select a specific corpus by its <strong>index</strong> in the list. Python starts counting at 0, so the first file in the list corresponds to</p>
<div id="cell-28" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>corpora[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>WindowsPath('C:/Users/fabianmoss/anaconda3/Lib/site-packages/music21/corpus/essenFolksong/altdeu10.abc')</code></pre>
</div>
</div>
<p>As you can see, this is just the first file path in the variable <code>corpora</code>. Let’s try to parse it!</p>
<div id="cell-30" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>first_corpus <span class="op">=</span> m21.converter.parse(corpora[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the new variable <code>first_corpus</code> shows a difference to the example song before; we don’t have a <code>music21.stream.Score</code> object but a <code>music21.stream.Opus</code> object.</p>
<div id="cell-32" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>first_corpus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>&lt;music21.stream.Opus 0x1898b5ff4c0&gt;</code></pre>
</div>
</div>
<p>If we would call the <code>.show()</code> method on <code>first_corpus</code>, we would see the scores of all pieces that are in this particular corpus. But we don’t know how many these are. It there are only three songs, it would not be a problem, but if there were thousands of songs, it could take a very long time to parse and display them all. Fortunately, all pieces in the collection have the <code>X:n</code> line that we saw above, so that we can directly reference them. With which number would we have to replace <code>n</code> if we wanted to look at the 7tst piece? Remember that Python starts counting at 0.</p>
<div id="cell-34" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>first_corpus[<span class="dv">70</span>].show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-16-output-1.png" width="753" height="286" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>A A B A’</p>
<div id="cell-36" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>first_corpus[<span class="dv">70</span>].show(<span class="st">"midi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

                <div id="midiPlayerDiv27804"></div>
                <link rel="stylesheet" href="//cuthbertLab.github.io/music21j/css/m21.css" type="text/css">
                <script>
                require.config({
                    paths: {'music21': '//cuthbertLab.github.io/music21j/src/music21'}
                });
                require(['music21'], function() {
                               mp = new music21.miditools.MidiPlayer();
                               mp.addPlayer('#midiPlayerDiv27804');
                               mp.base64Load('data:audio/midi;base64,TVRoZAAAAAYAAQABBABNVHJrAAABogD/AwAA4ABAAP9ZAgEAAP9YBAQCGAiIAJA+WogAgD4AAJBDWpAAgEMAAJBHWpAAgEcAAJBKWpgAgEoAAJBIWogAgEgAAJBHWpAAgEcAAJBFWpAAgEUAAJBDWpAAgEMAiACQPlqIAIA+AACQQ1qQAIBDAACQR1qQAIBHAACQSlqYAIBKAACQSFqIAIBIAACQR1qQAIBHAACQRVqQAIBFAACQQ1qQAIBDAIgAkEdaiACARwAAkEdaiACARwAAkEdaiACARwAAkEdaiACARwAAkEdaiACARwAAkEdakACARwAAkEVaiACARQAAkENaiACAQwAAkEdaiACARwAAkEpaiACASgAAkEhaiACASAAAkEdaiACARwAAkEVakACARQCIAJA+WogAgD4AAJBDWogAgEMAAJBFWogAgEUAAJBHWogAgEcAAJBIWogAgEgAAJBKWowAgEoAAJBMWoQAgEwAAJBKWogAgEoAAJBIWogAgEgAAJBHWogAgEcAAJBHWogAgEcAAJBFWogAgEUAAJBFWogAgEUAAJBDWpAAgEMAiAD/LwA=');
                        });
                </script>
</div>
</div>
<p>We have seen that we can select items from lists by <strong>indexing</strong> them, <code>list[i]</code>. We can get ranges of lists by using the <code>:</code> character. For example, <code>list[:10]</code> shows the first ten elements, <code>list[10:]</code> shows everything after the ninth element, and <code>list[3:6]</code> shows elements 3, 4, and 5 (not 6!) of the list.</p>
</section>
<section id="comparing-songs" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="comparing-songs"><span class="header-section-number">14.2</span> Comparing songs</h2>
<p>Looking at individual songs is interesting for music analysis but for that the computational approach is not really necessary. We could as easily do the same by just looking at a book of scores. The power of computational methods becomes clearer when we start comparing different songs, potentially in a large number.</p>
<p>To facilitate this comparison, we will first load all songs in all corpora of the EFC into a single list, called <code>songs</code> (this might take a couple of minutes).</p>
<div id="cell-40" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>songs <span class="op">=</span> [s <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(corpora)) <span class="cf">for</span> s <span class="kw">in</span> m21.converter.parse(corpora[i]) ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This looks a bit complicated but all it does is to go through all corpora and extract all songs into a new list. The way we did it is called <strong>list comprehension</strong> in Python. It is not important if you don’t understand this now but feel free to look it up!</p>
<p>Using the <code>len()</code> function again, we see how many songs we have in total.</p>
<div id="cell-43" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(songs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>8514</code></pre>
</div>
</div>
<p>We can now use the list <code>songs</code> to compare two different songs. Again, we load the 71st song of the first corpus and store it now in a variable <code>german_song</code>, and we load chinese song with index 6200 into the variable <code>chinese_song</code>.</p>
<div id="cell-45" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>german_song <span class="op">=</span> songs[<span class="dv">70</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>chinese_song <span class="op">=</span> songs[<span class="dv">6200</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It is easy to display these songs now:</p>
<div id="cell-47" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>german_song.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-21-output-1.png" width="753" height="286" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-48" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>chinese_song.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-22-output-1.png" width="753" height="286" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>chinese_song.show(<span class="st">"midi"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

                <div id="midiPlayerDiv684563"></div>
                <link rel="stylesheet" href="//cuthbertLab.github.io/music21j/css/m21.css" type="text/css">
                <script>
                require.config({
                    paths: {'music21': '//cuthbertLab.github.io/music21j/src/music21'}
                });
                require(['music21'], function() {
                               mp = new music21.miditools.MidiPlayer();
                               mp.addPlayer('#midiPlayerDiv684563');
                               mp.base64Load('data:audio/midi;base64,TVRoZAAAAAYAAQABBABNVHJrAAACZgD/AwAA4ABAAP9ZAv8AAP9YBAICGAiIAJBIWoYAgEgAAJBIWoIAgEgAAJBKWoQAgEoAAJBNWoQAgE0AAJBIWoYAgEgAAJBKWoIAgEoAAJBIWoQAgEgAAJBFWoQAgEUAAJBDWoQAgEMAAJBFWoIAgEUAAJBIWoIAgEgAAJBBWoQAgEEAAJBAWoIAgEAAAJA+WoIAgD4AAJA8WpAAgDwAAJBFWoQAgEUAAJBFWoQAgEUAAJBIWoQAgEgAAJBKWoQAgEoAAJBNWoQAgE0AAJBKWoQAgEoAAJBIWoQAgEgAhACQSFqEAIBIAACQRVqEAIBFAACQQ1qEAIBDAACQPlqEAIA+AACQQVqQAIBBAACQRVqEAIBFAACQRVqCAIBFAACQSFqCAIBIAACQPlqEAIA+AACQQVqEAIBBAACQSFqGAIBIAACQSlqCAIBKAACQSFqEAIBIAACQRVqEAIBFAACQQ1qEAIBDAACQRVqCAIBFAACQSFqCAIBIAACQPlqEAIA+AACQQVqEAIBBAACQQ1qQAIBDAACQRVqGAIBFAACQRVqCAIBFAACQSFqEAIBIAACQSlqEAIBKAACQTVqEAIBNAACQSlqEAIBKAACQSFqEAIBIAACQRVqEAIBFAACQQ1qEAIBDAACQQ1qCAIBDAACQRVqCAIBFAACQQ1qCAIBDAACQQVqCAIBBAACQPlqEAIA+AACQSFqMAIBIAACQRVqEAIBFAACQQ1qEAIBDAACQQ1qCAIBDAACQRVqCAIBFAACQQ1qCAIBDAACQQVqCAIBBAACQPlqEAIA+AACQQVqQAIBBAIgA/y8A');
                        });
                </script>
</div>
</div>
<p>Analysis of songs…</p>
</section>
<section id="computational-analysis" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="computational-analysis"><span class="header-section-number">14.3</span> Computational analysis</h2>
<p>We now go on to a computational analysis of these two and all the other songs. Specifically, we wil compare their <strong>melodic profiles</strong>. To make things a bit simpler, we will just look at the notes.</p>
<p>A note can be easily represented as a pair of <strong>pitch</strong> (its height) and its <strong>duration</strong>. For example, the first note of the <em>Die plappernden Junggesellen</em> could be represented as <code>(D4, 1/4)</code>; it is a quarter note on the pitch D4 (the 4 indicates the octave in which the note is).</p>
<p>Another way to represent the pitch of notes is using <strong>MIDI numbers</strong>. MIDI stands for <em>Musical Instrument Digital Interface</em> and was developed for the communication between different electronic instruments such as keyboards. In MIDI, each note is simply associated with a number:</p>
<p><img src="img/midi_pitch.png" class="img-fluid" alt="MIDI Pitch"> <em>Image from https://www.audiolabs-erlangen.de/resources/MIR/FMP/C1/C1S2_MIDI.html.</em></p>
<p>We can see that D4 is associated with the number 62. The second note, the G4, is associated with 62+5=67 because G is five semitones above D.</p>
<p>To make it easier to work with pieces in this way, we define a <strong>function</strong> that gives us a list of notes for each piece.</p>
<div id="cell-55" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> notelist(piece):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">    This function takes a song as input and returns a list of (pitch, duration) pairs, </span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">    where the duration is given in quarter notes.</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame([ (note.pitch.midi, note.quarterLength) <span class="cf">for</span> note <span class="kw">in</span> piece.flat.notes ], columns<span class="op">=</span>[<span class="st">"MIDI Pitch"</span>, <span class="st">"Duration"</span>])</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"Onset"</span>] <span class="op">=</span> df[<span class="st">"Duration"</span>].cumsum()</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the duration of a note is given in quarter notes, i.e.&nbsp;a quarter note has a duration of 1, a half note has a duration of 2, and an eighth note has a duration of 0.5.</p>
<p>Let’s display the first phrase (the first eight notes) of the German song:</p>
<div id="cell-57" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>notelist(german_song)[:<span class="dv">8</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MIDI Pitch</th>
<th data-quarto-table-cell-role="th">Duration</th>
<th data-quarto-table-cell-role="th">Onset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>62</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>67</td>
<td>2.0</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>71</td>
<td>2.0</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>74</td>
<td>3.0</td>
<td>8.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>72</td>
<td>1.0</td>
<td>9.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>71</td>
<td>2.0</td>
<td>11.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>69</td>
<td>2.0</td>
<td>13.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>67</td>
<td>2.0</td>
<td>15.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that we added another column, “Onset”. What does it represent?</p>
<p>This allows us now to look at the <strong>melodic profile</strong> of a particular song.</p>
<div id="cell-59" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_melodic_profile(notelist, ax<span class="op">=</span><span class="va">None</span>, c<span class="op">=</span><span class="va">None</span>, mean<span class="op">=</span><span class="va">False</span>, Z<span class="op">=</span><span class="va">False</span>, sections<span class="op">=</span><span class="va">False</span>, standardized<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ax <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>        ax <span class="op">=</span> plt.gca()</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> standardized:</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> notelist[<span class="st">"Rel. Onset"</span>]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> notelist[<span class="st">"Rel. MIDI Pitch"</span>]</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> notelist[<span class="st">"Onset"</span>]</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> notelist[<span class="st">"MIDI Pitch"</span>]</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    ax.step(x,y, color<span class="op">=</span>c)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mean:</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        ax.axhline(y.mean(), color<span class="op">=</span><span class="st">"gray"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sections:</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> l <span class="kw">in</span> [ x.<span class="bu">max</span>() <span class="op">*</span> i <span class="cf">for</span> i <span class="kw">in</span> [ <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="dv">3</span><span class="op">/</span><span class="dv">4</span>] ]:</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>            ax.axvline(l, color<span class="op">=</span><span class="st">"gray"</span>, linewidth<span class="op">=</span><span class="dv">1</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-60" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>plot_melodic_profile(notelist(german_song))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-27-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Likewise, we can as easily plot the melodic contour of the Chinese song (we will use a different color).</p>
<div id="cell-62" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">6</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>plot_melodic_profile(notelist(german_song), ax<span class="op">=</span>axes[<span class="dv">0</span>], mean<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>plot_melodic_profile(notelist(chinese_song), ax<span class="op">=</span>axes[<span class="dv">1</span>], c<span class="op">=</span><span class="st">"firebrick"</span>, mean<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"img/melodic_profiles.png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The dashed grey lines in both plots show the average MIDI pitch of the song.</p>
<p>But still, it is quite difficult to compare them directly. They differ both with respect to their length (see the numbers on the “Onset” axis) and their pitches (see “MIDI Pitch” axis).</p>
<p>We need to transform them in a way that makes them directly comparable. To that end, we define a new function <code>standardize()</code>.</p>
<div id="cell-64" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> standardize(notelist):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Takes a notelist as input and returns a standardized version.</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    notelist[<span class="st">"Rel. MIDI Pitch"</span>] <span class="op">=</span> (notelist[<span class="st">"MIDI Pitch"</span>] <span class="op">-</span> notelist[<span class="st">"MIDI Pitch"</span>].mean()) <span class="op">/</span> notelist[<span class="st">"MIDI Pitch"</span>].std()</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    notelist[<span class="st">"Rel. Duration"</span>] <span class="op">=</span> notelist[<span class="st">"Duration"</span>] <span class="op">/</span> notelist[<span class="st">"Duration"</span>].<span class="bu">sum</span>()</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    notelist[<span class="st">"Rel. Onset"</span>] <span class="op">=</span> notelist[<span class="st">"Onset"</span>] <span class="op">/</span> notelist[<span class="st">"Onset"</span>].<span class="bu">max</span>()</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> notelist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-65" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>standardize(notelist(german_song))[:<span class="dv">8</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MIDI Pitch</th>
<th data-quarto-table-cell-role="th">Duration</th>
<th data-quarto-table-cell-role="th">Onset</th>
<th data-quarto-table-cell-role="th">Rel. MIDI Pitch</th>
<th data-quarto-table-cell-role="th">Rel. Duration</th>
<th data-quarto-table-cell-role="th">Rel. Onset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>62</td>
<td>1.0</td>
<td>1.0</td>
<td>-2.543827</td>
<td>0.016667</td>
<td>0.016667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>67</td>
<td>2.0</td>
<td>3.0</td>
<td>-0.949300</td>
<td>0.033333</td>
<td>0.050000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>71</td>
<td>2.0</td>
<td>5.0</td>
<td>0.326322</td>
<td>0.033333</td>
<td>0.083333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>74</td>
<td>3.0</td>
<td>8.0</td>
<td>1.283038</td>
<td>0.050000</td>
<td>0.133333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>72</td>
<td>1.0</td>
<td>9.0</td>
<td>0.645227</td>
<td>0.016667</td>
<td>0.150000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>71</td>
<td>2.0</td>
<td>11.0</td>
<td>0.326322</td>
<td>0.033333</td>
<td>0.183333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>69</td>
<td>2.0</td>
<td>13.0</td>
<td>-0.311489</td>
<td>0.033333</td>
<td>0.216667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>67</td>
<td>2.0</td>
<td>15.0</td>
<td>-0.949300</td>
<td>0.033333</td>
<td>0.250000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-66" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>plot_melodic_profile(standardize(notelist(german_song)), mean<span class="op">=</span><span class="va">True</span>, sections<span class="op">=</span><span class="va">True</span>, standardized<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>plot_melodic_profile(standardize(notelist(chinese_song)), c<span class="op">=</span><span class="st">"firebrick"</span>, standardized<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Standardizing the songs makes it possible to compare them directly: They have now the same length 1 and their pitches are centered around the mean 0 with a standard deviation of 1.</p>
<p>However, already with two pieces this plot is quite crowded.</p>
<div id="cell-68" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> [ ]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, song <span class="kw">in</span> <span class="bu">enumerate</span>(songs):</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> standardize(notelist(song))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"Song ID"</span>] <span class="op">=</span> i</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    dfs.append(df)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>big_df <span class="op">=</span> pd.concat(dfs).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-69" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>big_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MIDI Pitch</th>
<th data-quarto-table-cell-role="th">Duration</th>
<th data-quarto-table-cell-role="th">Onset</th>
<th data-quarto-table-cell-role="th">Rel. MIDI Pitch</th>
<th data-quarto-table-cell-role="th">Rel. Duration</th>
<th data-quarto-table-cell-role="th">Rel. Onset</th>
<th data-quarto-table-cell-role="th">Song ID</th>
<th data-quarto-table-cell-role="th">Avg. MIDI Pitch</th>
<th data-quarto-table-cell-role="th">shifted_pitch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>67</td>
<td>2.00</td>
<td>2.00</td>
<td>-1.819039</td>
<td>0.013158</td>
<td>0.013158</td>
<td>0</td>
<td>72</td>
<td>-5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>70</td>
<td>2.00</td>
<td>4.00</td>
<td>-0.741977</td>
<td>0.013158</td>
<td>0.026316</td>
<td>0</td>
<td>72</td>
<td>-2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>71</td>
<td>2.00</td>
<td>6.00</td>
<td>-0.382956</td>
<td>0.013158</td>
<td>0.039474</td>
<td>0</td>
<td>72</td>
<td>-1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>72</td>
<td>2.00</td>
<td>8.00</td>
<td>-0.023935</td>
<td>0.013158</td>
<td>0.052632</td>
<td>0</td>
<td>72</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>72</td>
<td>2.00</td>
<td>10.00</td>
<td>-0.023935</td>
<td>0.013158</td>
<td>0.065789</td>
<td>0</td>
<td>72</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">450591</td>
<td>71</td>
<td>0.25</td>
<td>28.50</td>
<td>0.691456</td>
<td>0.008197</td>
<td>0.934426</td>
<td>8513</td>
<td>68</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">450592</td>
<td>69</td>
<td>0.25</td>
<td>28.75</td>
<td>0.098779</td>
<td>0.008197</td>
<td>0.942623</td>
<td>8513</td>
<td>68</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">450593</td>
<td>73</td>
<td>0.25</td>
<td>29.00</td>
<td>1.284133</td>
<td>0.008197</td>
<td>0.950820</td>
<td>8513</td>
<td>68</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">450594</td>
<td>71</td>
<td>1.00</td>
<td>30.00</td>
<td>0.691456</td>
<td>0.032787</td>
<td>0.983607</td>
<td>8513</td>
<td>68</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">450595</td>
<td>69</td>
<td>0.50</td>
<td>30.50</td>
<td>0.098779</td>
<td>0.016393</td>
<td>1.000000</td>
<td>8513</td>
<td>68</td>
<td>1</td>
</tr>
</tbody>
</table>

<p>450596 rows × 9 columns</p>
</div>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>big_df.to_csv(<span class="st">"data/big_df.csv"</span>) <span class="co"># comma-separated values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-71" class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>big_df <span class="op">=</span> pd.read_csv(<span class="st">"data/big_df.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-melodic-arc" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="the-melodic-arc"><span class="header-section-number">14.4</span> The melodic arc</h2>
<div id="cell-73" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>,<span class="dv">8</span>))</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> big_df.groupby(<span class="st">"Song ID"</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, g <span class="kw">in</span> grouped:</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> g[<span class="st">"Rel. Onset"</span>]</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> g[<span class="st">"Rel. MIDI Pitch"</span>]</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    ax.plot(x,y, lw<span class="op">=</span><span class="fl">.5</span>, c<span class="op">=</span><span class="st">"tab:red"</span>, alpha<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="fl">.25</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">"--"</span>, c<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="fl">.5</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">"--"</span>, c<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="fl">.75</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">"--"</span>, c<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="dv">0</span>, lw<span class="op">=</span><span class="dv">1</span>, ls<span class="op">=</span><span class="st">"--"</span>, c<span class="op">=</span><span class="st">"gray"</span>)</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>lowess <span class="op">=</span> sm.nonparametric.lowess</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>big_x <span class="op">=</span> big_df[<span class="st">"Rel. Onset"</span>]</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>big_y <span class="op">=</span> big_df[<span class="st">"Rel. MIDI Pitch"</span>]</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>big_z <span class="op">=</span> lowess(big_y, big_x, frac<span class="op">=</span><span class="dv">5</span><span class="op">/</span><span class="dv">100</span>, delta<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">20</span>) <span class="co"># Locally-Weighted Scatterplot Smoothing</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>ax.plot(big_z[:,<span class="dv">0</span>], big_z[:,<span class="dv">1</span>], c<span class="op">=</span><span class="st">"black"</span>, lw<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Melodic arc"</span>)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Relative onset"</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Pitch deviation"</span>)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>plt.xticks(np.linspace(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">5</span>))</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>plt.yticks(np.linspace(<span class="op">-</span><span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">11</span>))</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"img/melodic_arc.png"</span>)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Wall time: 24.1 s</code></pre>
</div>
</div>
</section>
<section id="intervals" class="level2" data-number="14.5">
<h2 data-number="14.5" class="anchored" data-anchor-id="intervals"><span class="header-section-number">14.5</span> Intervals</h2>
<p>We have seen that the melodic arc emerges as a stable shape over the entire EFC, and that sub-phrases of the songs likewise have an arc-like shape. In the remainder of this section, we look at <strong>intervals</strong>, the distance between two notes.</p>
<p>Let’s come back to the song <em>Die plappernden Junggesellen</em></p>
<div id="cell-76" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>german_song.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-37-output-1.png" width="753" height="286" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We have already extracted its notes and stored them in a DataFrame:</p>
<div id="cell-78" class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>big_df[ big_df[<span class="st">"Song ID"</span>] <span class="op">==</span> <span class="dv">70</span>].head(<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">Unnamed: 0.1</th>
<th data-quarto-table-cell-role="th">MIDI Pitch</th>
<th data-quarto-table-cell-role="th">Duration</th>
<th data-quarto-table-cell-role="th">Onset</th>
<th data-quarto-table-cell-role="th">Rel. MIDI Pitch</th>
<th data-quarto-table-cell-role="th">Rel. Duration</th>
<th data-quarto-table-cell-role="th">Rel. Onset</th>
<th data-quarto-table-cell-role="th">Song ID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2969</td>
<td>2969</td>
<td>2969</td>
<td>62</td>
<td>1.0</td>
<td>1.0</td>
<td>-2.543827</td>
<td>0.016667</td>
<td>0.016667</td>
<td>70</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2970</td>
<td>2970</td>
<td>2970</td>
<td>67</td>
<td>2.0</td>
<td>3.0</td>
<td>-0.949300</td>
<td>0.033333</td>
<td>0.050000</td>
<td>70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2971</td>
<td>2971</td>
<td>2971</td>
<td>71</td>
<td>2.0</td>
<td>5.0</td>
<td>0.326322</td>
<td>0.033333</td>
<td>0.083333</td>
<td>70</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2972</td>
<td>2972</td>
<td>2972</td>
<td>74</td>
<td>3.0</td>
<td>8.0</td>
<td>1.283038</td>
<td>0.050000</td>
<td>0.133333</td>
<td>70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2973</td>
<td>2973</td>
<td>2973</td>
<td>72</td>
<td>1.0</td>
<td>9.0</td>
<td>0.645227</td>
<td>0.016667</td>
<td>0.150000</td>
<td>70</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2974</td>
<td>2974</td>
<td>2974</td>
<td>71</td>
<td>2.0</td>
<td>11.0</td>
<td>0.326322</td>
<td>0.033333</td>
<td>0.183333</td>
<td>70</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2975</td>
<td>2975</td>
<td>2975</td>
<td>69</td>
<td>2.0</td>
<td>13.0</td>
<td>-0.311489</td>
<td>0.033333</td>
<td>0.216667</td>
<td>70</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2976</td>
<td>2976</td>
<td>2976</td>
<td>67</td>
<td>2.0</td>
<td>15.0</td>
<td>-0.949300</td>
<td>0.033333</td>
<td>0.250000</td>
<td>70</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The code above reads as “Select all rows in <code>big_df</code> for which the column <code>Song ID</code> is equal to 70”. The <code>.head()</code> method displays the first 5 rows by default but you can specify the number of rows you want to be displayed (here 8).</p>
<p>Focusing on the “MIDI Pitch” column, the notes in the first phrase have MIDI pitch 62, 67, 71, 74, 72. Since intervals correspond to the difference between notes, the intervals for the beginning of this song are:</p>
<ul>
<li>+5 (67-62)</li>
<li>+4 (71-67)</li>
<li>+3 (74-71)</li>
<li>-2 (72-74)</li>
<li>-1 (71-72)</li>
<li>-2 (69-71)</li>
<li>-2 (67-69)</li>
</ul>
<p>The sequence of intervals in this phrase is thus <code>[+5, +4, +3, -2, -1, -2, -2]</code>. The signs (+ or -) also reflect the arc-like shape of this first phrase, but the sizes of the intervals are not perfecly balanced. Note that <code>-2</code> (two descending semitones, or one descending whole tone) is the most frequent interval.</p>
<div id="cell-81" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>all_ints <span class="op">=</span> [ p2 <span class="op">-</span> p1 <span class="cf">for</span> i, g <span class="kw">in</span> big_df.groupby(<span class="st">"Song ID"</span>) <span class="cf">for</span> p1, p2 <span class="kw">in</span> <span class="bu">zip</span>(g[<span class="st">"MIDI Pitch"</span>], g[<span class="st">"MIDI Pitch"</span>][<span class="dv">1</span>:]) ]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>min_int <span class="op">=</span> <span class="bu">min</span>(all_ints)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>max_int <span class="op">=</span> <span class="bu">max</span>(all_ints)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-82" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>min_int, max_int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<pre><code>(-25, 25)</code></pre>
</div>
</div>
<div id="cell-83" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(all_ints)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>442082</code></pre>
</div>
</div>
<div id="cell-84" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ints_df <span class="op">=</span> pd.DataFrame(<span class="dv">0</span>, index<span class="op">=</span>np.arange(min_int,max_int), columns<span class="op">=</span>np.arange(min_int,max_int<span class="op">+</span><span class="dv">1</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, g <span class="kw">in</span> big_df.groupby(<span class="st">"Song ID"</span>):</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    intervals <span class="op">=</span> [ p2 <span class="op">-</span> p1 <span class="cf">for</span> p1, p2 <span class="kw">in</span> <span class="bu">zip</span>(g[<span class="st">"MIDI Pitch"</span>], g[<span class="st">"MIDI Pitch"</span>][<span class="dv">1</span>:])]</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i1, i2 <span class="kw">in</span> <span class="bu">zip</span>(intervals, intervals[<span class="dv">1</span>:]):</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        ints_df.loc[i1,i2] <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-85" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>ints_df.loc[<span class="op">-</span><span class="dv">10</span>:<span class="dv">10</span>, <span class="op">-</span><span class="dv">10</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">-10</th>
<th data-quarto-table-cell-role="th">-9</th>
<th data-quarto-table-cell-role="th">-8</th>
<th data-quarto-table-cell-role="th">-7</th>
<th data-quarto-table-cell-role="th">-6</th>
<th data-quarto-table-cell-role="th">-5</th>
<th data-quarto-table-cell-role="th">-4</th>
<th data-quarto-table-cell-role="th">-3</th>
<th data-quarto-table-cell-role="th">-2</th>
<th data-quarto-table-cell-role="th">-1</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">1</th>
<th data-quarto-table-cell-role="th">2</th>
<th data-quarto-table-cell-role="th">3</th>
<th data-quarto-table-cell-role="th">4</th>
<th data-quarto-table-cell-role="th">5</th>
<th data-quarto-table-cell-role="th">6</th>
<th data-quarto-table-cell-role="th">7</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">-10</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>34</td>
<td>0</td>
<td>...</td>
<td>16</td>
<td>174</td>
<td>219</td>
<td>60</td>
<td>91</td>
<td>0</td>
<td>78</td>
<td>67</td>
<td>29</td>
<td>243</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>6</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>39</td>
<td>10</td>
<td>31</td>
<td>...</td>
<td>5</td>
<td>159</td>
<td>39</td>
<td>40</td>
<td>313</td>
<td>2</td>
<td>30</td>
<td>0</td>
<td>111</td>
<td>27</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-8</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>319</td>
<td>5</td>
<td>...</td>
<td>302</td>
<td>66</td>
<td>605</td>
<td>3</td>
<td>159</td>
<td>2</td>
<td>4</td>
<td>73</td>
<td>0</td>
<td>32</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-7</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>14</td>
<td>0</td>
<td>37</td>
<td>2</td>
<td>91</td>
<td>96</td>
<td>103</td>
<td>...</td>
<td>17</td>
<td>859</td>
<td>300</td>
<td>527</td>
<td>651</td>
<td>1</td>
<td>399</td>
<td>18</td>
<td>219</td>
<td>141</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>12</td>
<td>11</td>
<td>8</td>
<td>21</td>
<td>...</td>
<td>274</td>
<td>7</td>
<td>132</td>
<td>25</td>
<td>10</td>
<td>19</td>
<td>6</td>
<td>3</td>
<td>3</td>
<td>4</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-5</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>49</td>
<td>0</td>
<td>75</td>
<td>32</td>
<td>866</td>
<td>1361</td>
<td>25</td>
<td>...</td>
<td>230</td>
<td>1906</td>
<td>1272</td>
<td>148</td>
<td>2131</td>
<td>22</td>
<td>252</td>
<td>87</td>
<td>368</td>
<td>160</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-4</td>
<td>3</td>
<td>0</td>
<td>27</td>
<td>11</td>
<td>5</td>
<td>461</td>
<td>18</td>
<td>692</td>
<td>167</td>
<td>1099</td>
<td>...</td>
<td>129</td>
<td>2738</td>
<td>40</td>
<td>1610</td>
<td>616</td>
<td>13</td>
<td>884</td>
<td>8</td>
<td>269</td>
<td>31</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-3</td>
<td>1</td>
<td>91</td>
<td>0</td>
<td>192</td>
<td>2</td>
<td>215</td>
<td>2490</td>
<td>416</td>
<td>9478</td>
<td>134</td>
<td>...</td>
<td>2547</td>
<td>1467</td>
<td>6274</td>
<td>109</td>
<td>1684</td>
<td>13</td>
<td>403</td>
<td>508</td>
<td>59</td>
<td>261</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-2</td>
<td>67</td>
<td>14</td>
<td>260</td>
<td>858</td>
<td>132</td>
<td>1964</td>
<td>113</td>
<td>8871</td>
<td>21285</td>
<td>13896</td>
<td>...</td>
<td>454</td>
<td>14883</td>
<td>1115</td>
<td>2616</td>
<td>3216</td>
<td>63</td>
<td>1681</td>
<td>88</td>
<td>537</td>
<td>407</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-1</td>
<td>5</td>
<td>174</td>
<td>4</td>
<td>68</td>
<td>47</td>
<td>32</td>
<td>1679</td>
<td>91</td>
<td>13445</td>
<td>205</td>
<td>...</td>
<td>5410</td>
<td>396</td>
<td>2878</td>
<td>58</td>
<td>477</td>
<td>44</td>
<td>23</td>
<td>241</td>
<td>3</td>
<td>52</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>186</td>
<td>130</td>
<td>310</td>
<td>1022</td>
<td>80</td>
<td>2270</td>
<td>1440</td>
<td>5506</td>
<td>16887</td>
<td>4603</td>
<td>...</td>
<td>2578</td>
<td>12142</td>
<td>4947</td>
<td>3340</td>
<td>5203</td>
<td>30</td>
<td>1353</td>
<td>292</td>
<td>824</td>
<td>478</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>55</td>
<td>6</td>
<td>174</td>
<td>43</td>
<td>110</td>
<td>944</td>
<td>165</td>
<td>2564</td>
<td>501</td>
<td>3765</td>
<td>...</td>
<td>747</td>
<td>7649</td>
<td>193</td>
<td>1470</td>
<td>132</td>
<td>26</td>
<td>172</td>
<td>9</td>
<td>59</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>138</td>
<td>294</td>
<td>29</td>
<td>1288</td>
<td>15</td>
<td>1361</td>
<td>3754</td>
<td>2562</td>
<td>15795</td>
<td>254</td>
<td>...</td>
<td>8404</td>
<td>11261</td>
<td>5249</td>
<td>86</td>
<td>1695</td>
<td>2</td>
<td>187</td>
<td>171</td>
<td>57</td>
<td>61</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>272</td>
<td>23</td>
<td>373</td>
<td>655</td>
<td>122</td>
<td>1755</td>
<td>24</td>
<td>5509</td>
<td>3397</td>
<td>2400</td>
<td>...</td>
<td>295</td>
<td>4128</td>
<td>231</td>
<td>519</td>
<td>1523</td>
<td>35</td>
<td>180</td>
<td>0</td>
<td>122</td>
<td>11</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>5</td>
<td>164</td>
<td>3</td>
<td>130</td>
<td>11</td>
<td>51</td>
<td>1026</td>
<td>64</td>
<td>4217</td>
<td>60</td>
<td>...</td>
<td>1133</td>
<td>67</td>
<td>3153</td>
<td>20</td>
<td>102</td>
<td>7</td>
<td>1</td>
<td>14</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>116</td>
<td>23</td>
<td>505</td>
<td>330</td>
<td>13</td>
<td>1996</td>
<td>82</td>
<td>2375</td>
<td>2834</td>
<td>1868</td>
<td>...</td>
<td>102</td>
<td>2557</td>
<td>270</td>
<td>1355</td>
<td>160</td>
<td>1</td>
<td>94</td>
<td>0</td>
<td>16</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2</td>
<td>4</td>
<td>1</td>
<td>4</td>
<td>23</td>
<td>1</td>
<td>14</td>
<td>18</td>
<td>44</td>
<td>34</td>
<td>...</td>
<td>42</td>
<td>8</td>
<td>20</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>31</td>
<td>18</td>
<td>11</td>
<td>273</td>
<td>3</td>
<td>167</td>
<td>128</td>
<td>665</td>
<td>1338</td>
<td>59</td>
<td>...</td>
<td>119</td>
<td>566</td>
<td>249</td>
<td>12</td>
<td>166</td>
<td>0</td>
<td>8</td>
<td>2</td>
<td>6</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>47</td>
<td>1</td>
<td>88</td>
<td>7</td>
<td>19</td>
<td>149</td>
<td>4</td>
<td>370</td>
<td>33</td>
<td>384</td>
<td>...</td>
<td>23</td>
<td>159</td>
<td>0</td>
<td>23</td>
<td>6</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>1</td>
<td>61</td>
<td>1</td>
<td>20</td>
<td>3</td>
<td>20</td>
<td>442</td>
<td>18</td>
<td>1024</td>
<td>4</td>
<td>...</td>
<td>122</td>
<td>13</td>
<td>129</td>
<td>1</td>
<td>8</td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>267</td>
<td>0</td>
<td>56</td>
<td>23</td>
<td>28</td>
<td>58</td>
<td>0</td>
<td>517</td>
<td>163</td>
<td>295</td>
<td>...</td>
<td>3</td>
<td>78</td>
<td>0</td>
<td>4</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>21 rows × 21 columns</p>
</div>
</div>
</div>
<div id="cell-86" class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(ints_df.loc[<span class="op">-</span><span class="dv">12</span>:<span class="dv">13</span>,<span class="op">-</span><span class="dv">12</span>:<span class="dv">13</span>], cmap<span class="op">=</span><span class="st">"coolwarm"</span>, square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="fl">0.01</span>,ax<span class="op">=</span>ax)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"First interval"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Second interval"</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-44-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The two most common interval pairs are <code>(0,0)</code> and <code>(-2,-2)</code>. A much less frequent pair of intervals is <code>(5,0)</code>, but this is still much more frequent than, for example, <code>(9,9)</code>.</p>
<p>To which melodic fragments do these correspond?</p>
<div id="cell-88" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>big_df[<span class="st">"Avg. MIDI Pitch"</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, group <span class="kw">in</span> big_df.groupby(<span class="st">"Song ID"</span>):</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    grp_mean_pitch <span class="op">=</span> <span class="bu">int</span>(group[<span class="st">"MIDI Pitch"</span>].mean())</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    big_df.loc[big_df[<span class="st">"Song ID"</span>] <span class="op">==</span> i, <span class="st">"Avg. MIDI Pitch"</span>] <span class="op">=</span> grp_mean_pitch</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-89" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>big_df[<span class="st">"shifted_pitch"</span>] <span class="op">=</span> big_df[<span class="st">"MIDI Pitch"</span>] <span class="op">-</span> big_df[<span class="st">"Avg. MIDI Pitch"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-90" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>big_df.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">MIDI Pitch</th>
<th data-quarto-table-cell-role="th">Duration</th>
<th data-quarto-table-cell-role="th">Onset</th>
<th data-quarto-table-cell-role="th">Rel. MIDI Pitch</th>
<th data-quarto-table-cell-role="th">Rel. Duration</th>
<th data-quarto-table-cell-role="th">Rel. Onset</th>
<th data-quarto-table-cell-role="th">Song ID</th>
<th data-quarto-table-cell-role="th">Avg. MIDI Pitch</th>
<th data-quarto-table-cell-role="th">shifted_pitch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">450591</td>
<td>71</td>
<td>0.25</td>
<td>28.50</td>
<td>0.691456</td>
<td>0.008197</td>
<td>0.934426</td>
<td>8513</td>
<td>68</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">450592</td>
<td>69</td>
<td>0.25</td>
<td>28.75</td>
<td>0.098779</td>
<td>0.008197</td>
<td>0.942623</td>
<td>8513</td>
<td>68</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">450593</td>
<td>73</td>
<td>0.25</td>
<td>29.00</td>
<td>1.284133</td>
<td>0.008197</td>
<td>0.950820</td>
<td>8513</td>
<td>68</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">450594</td>
<td>71</td>
<td>1.00</td>
<td>30.00</td>
<td>0.691456</td>
<td>0.032787</td>
<td>0.983607</td>
<td>8513</td>
<td>68</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">450595</td>
<td>69</td>
<td>0.50</td>
<td>30.50</td>
<td>0.098779</td>
<td>0.016393</td>
<td>1.000000</td>
<td>8513</td>
<td>68</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-91" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>idx <span class="op">=</span> np.arange(big_df[<span class="st">"shifted_pitch"</span>].<span class="bu">min</span>(), big_df[<span class="st">"shifted_pitch"</span>].<span class="bu">max</span>() <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>array([-16, -15, -14, -13, -12, -11, -10,  -9,  -8,  -7,  -6,  -5,  -4,
        -3,  -2,  -1,   0,   1,   2,   3,   4,   5,   6,   7,   8,   9,
        10,  11,  12,  13,  14,  15,  16,  17])</code></pre>
</div>
</div>
<div id="cell-92" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>transitions_df <span class="op">=</span> pd.DataFrame(<span class="dv">0</span>, index<span class="op">=</span>idx, columns<span class="op">=</span>idx)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>transitions_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">-16</th>
<th data-quarto-table-cell-role="th">-15</th>
<th data-quarto-table-cell-role="th">-14</th>
<th data-quarto-table-cell-role="th">-13</th>
<th data-quarto-table-cell-role="th">-12</th>
<th data-quarto-table-cell-role="th">-11</th>
<th data-quarto-table-cell-role="th">-10</th>
<th data-quarto-table-cell-role="th">-9</th>
<th data-quarto-table-cell-role="th">-8</th>
<th data-quarto-table-cell-role="th">-7</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">8</th>
<th data-quarto-table-cell-role="th">9</th>
<th data-quarto-table-cell-role="th">10</th>
<th data-quarto-table-cell-role="th">11</th>
<th data-quarto-table-cell-role="th">12</th>
<th data-quarto-table-cell-role="th">13</th>
<th data-quarto-table-cell-role="th">14</th>
<th data-quarto-table-cell-role="th">15</th>
<th data-quarto-table-cell-role="th">16</th>
<th data-quarto-table-cell-role="th">17</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">-16</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-15</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-14</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-13</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-12</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-11</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-10</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-8</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-7</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-5</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">-2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>34 rows × 34 columns</p>
</div>
</div>
</div>
<div id="cell-93" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, group <span class="kw">in</span> big_df.groupby(<span class="st">"Song ID"</span>):</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bg <span class="kw">in</span> <span class="bu">zip</span>(group[<span class="st">"shifted_pitch"</span>], group[<span class="st">"shifted_pitch"</span>][<span class="dv">1</span>:]):</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        transitions_df.loc[bg[<span class="dv">0</span>],bg[<span class="dv">1</span>]] <span class="op">+=</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Wall time: 1min 29s</code></pre>
</div>
</div>
<div id="cell-94" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"There are </span><span class="sc">{</span>transitions_df<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">}</span><span class="ss"> intervals in total in the corpus."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>There are 442082 intervals in total in the corpus.</code></pre>
</div>
</div>
<div id="cell-95" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.heatmap(transitions_df, cmap<span class="op">=</span><span class="st">"coolwarm"</span>, linewidths<span class="op">=</span><span class="fl">.01</span>, square<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"First interval"</span>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Second interval"</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_melody_I_files/figure-html/cell-52-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="n-grams" class="level2" data-number="14.6">
<h2 data-number="14.6" class="anchored" data-anchor-id="n-grams"><span class="header-section-number">14.6</span> n-grams</h2>
<ul>
<li>n-gram viewer [https://www.peachnote.com/#!nt=singleNoteAffine&amp;npq=62+0+1+2] :cite:<code>Viro2011</code></li>
<li>theory on n-grams</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./12_dma_melody.html" class="pagination-link" aria-label="Digital music analysis: melody">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Digital music analysis: melody</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04_jazz_solos.html" class="pagination-link" aria-label="Solos in the *Weimar Jazz Database*">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Solos in the <em>Weimar Jazz Database</em></span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>